#!/usr/bin/env bash

#SBATCH --array=1-34
#SBATCH --partition=bch-gpu-pe
#SBATCH --job-name=missing
#SBATCH --output=logs/missing_%A_%a.out
#SBATCH --error=logs/missing_%A_%a.err
#SBATCH --gpus=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=16G

# HARDCODED Missing Persona Experiments
# Generated by: generate_hardcoded_missing.py
# DO NOT EDIT MANUALLY - regenerate if needed

set -e

###### Setup environment
# Directories (submitted from: .../slurm/)
SLURM_DIR="${SLURM_SUBMIT_DIR}"                         # .../experiments/linux_single/slurm
LINUX_SINGLE_DIR="$(cd "$SLURM_DIR/.." && pwd)"         # .../experiments/linux_single
PROJECT_ROOT="$(cd "$LINUX_SINGLE_DIR/../.." && pwd)"   # PROJECT_ROOT
RESULTS_DIR="$SLURM_DIR/results_hpc"                    # .../slurm/results_hpc
LOG_DIR="$SLURM_DIR/logs"                               # .../slurm/logs

mkdir -p "$LOG_DIR"/{math,gsm,biography,mmlu}
mkdir -p "$RESULTS_DIR"/{math,gsm,biography,mmlu}

# Huggingface cache
export HF_HOME=/temp_work/ch269957

# CUDA + conda setitngs
export PYTHONPATH="$PROJECT_ROOT:$PYTHONPATH"
export CUDA_VISIBLE_DEVICES=0
source /etc/bashrc
conda activate slm

# Hardcoded job parameters (no CSV parsing)
case $SLURM_ARRAY_TASK_ID in
    1)
        MODEL="vllm-llama32-3b"
        N_AGENTS=3
        ROUNDS=3
        TASK="math"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    2)
        MODEL="vllm-llama32-3b"
        N_AGENTS=5
        ROUNDS=3
        TASK="math"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    3)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=5
        ROUNDS=3
        TASK="math"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states')
        ;;
    4)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=7
        ROUNDS=3
        TASK="math"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Roman imperial jurist who strictly adheres to precedent and codified legal language' 'a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'a mythological hero'"'"'s sidekick who is overly cautious, risk-averse, and constantly points out dangers')
        ;;
    5)
        MODEL="vllm-vibethinker"
        N_AGENTS=3
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    6)
        MODEL="vllm-vibethinker"
        N_AGENTS=5
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    7)
        MODEL="vllm-vibethinker"
        N_AGENTS=7
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    8)
        MODEL="vllm-llama32-3b"
        N_AGENTS=3
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    9)
        MODEL="vllm-llama32-3b"
        N_AGENTS=5
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    10)
        MODEL="vllm-llama32-3b"
        N_AGENTS=7
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    11)
        MODEL="vllm-mistral-7b"
        N_AGENTS=3
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay')
        ;;
    12)
        MODEL="vllm-mistral-7b"
        N_AGENTS=5
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Gothic novelist who focuses on dramatic irony, foreshadowing, and latent horror' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a resource auditor who views every input as a budget line item that must be strictly justified' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay')
        ;;
    13)
        MODEL="vllm-mistral-7b"
        N_AGENTS=7
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Gothic novelist who focuses on dramatic irony, foreshadowing, and latent horror' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    14)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=5
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states')
        ;;
    15)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=7
        ROUNDS=3
        TASK="gsm"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Roman imperial jurist who strictly adheres to precedent and codified legal language' 'a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'a mythological hero'"'"'s sidekick who is overly cautious, risk-averse, and constantly points out dangers')
        ;;
    16)
        MODEL="vllm-vibethinker"
        N_AGENTS=3
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    17)
        MODEL="vllm-vibethinker"
        N_AGENTS=5
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    18)
        MODEL="vllm-vibethinker"
        N_AGENTS=7
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    19)
        MODEL="vllm-llama32-3b"
        N_AGENTS=5
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    20)
        MODEL="vllm-mistral-7b"
        N_AGENTS=3
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay')
        ;;
    21)
        MODEL="vllm-mistral-7b"
        N_AGENTS=5
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Gothic novelist who focuses on dramatic irony, foreshadowing, and latent horror' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a resource auditor who views every input as a budget line item that must be strictly justified' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay')
        ;;
    22)
        MODEL="vllm-mistral-7b"
        N_AGENTS=7
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Gothic novelist who focuses on dramatic irony, foreshadowing, and latent horror' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    23)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=5
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states')
        ;;
    24)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=7
        ROUNDS=3
        TASK="biography"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Roman imperial jurist who strictly adheres to precedent and codified legal language' 'a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'a mythological hero'"'"'s sidekick who is overly cautious, risk-averse, and constantly points out dangers')
        ;;
    25)
        MODEL="vllm-qwen3-0.6b"
        N_AGENTS=3
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    26)
        MODEL="vllm-qwen3-0.6b"
        N_AGENTS=5
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a quantum physicist who models all decisions as probabilistic wave function collapse' 'a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a resource auditor who views every input as a budget line item that must be strictly justified' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    27)
        MODEL="vllm-vibethinker"
        N_AGENTS=3
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    28)
        MODEL="vllm-vibethinker"
        N_AGENTS=5
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a drone swarm commander who views the task as parallel processing over numerous, interchangeable units' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    29)
        MODEL="vllm-vibethinker"
        N_AGENTS=7
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a forensic pathologist who works backward from the failure state to determine the precise cause of death' 'a stand-up comedian who evaluates suggestions based on their absurdity, timing, and satirical value' 'an expert chess grandmaster who analyzes all moves based on look-ahead, board state, and counterplay' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation' 'a hermetic alchemist who seeks to transmute the problem into a perfect, pure, and philosophical gold standard')
        ;;
    30)
        MODEL="vllm-llama32-3b"
        N_AGENTS=3
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    31)
        MODEL="vllm-llama32-3b"
        N_AGENTS=5
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    32)
        MODEL="vllm-llama32-3b"
        N_AGENTS=7
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'a Kantian deontologist who judges all actions strictly by their moral imperative and universal rule application' 'a Soviet-era bureaucrat who prioritizes documentation, adherence to arbitrary quotas, and triplicate forms' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a cosmic horror narrator who frames the problem as an ancient, unknowable, and terrifying truth' 'a Renaissance painter who values perspective, light, shadow, and visual harmony in the final presentation')
        ;;
    33)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=5
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states')
        ;;
    34)
        MODEL="vllm-qwen3-14b"
        N_AGENTS=7
        ROUNDS=3
        TASK="mmlu"
        NUM_VALUE=20
        RANDOM_SEED=42
        PERSONAS=('a Roman imperial jurist who strictly adheres to precedent and codified legal language' 'a radical anarchist who views all imposed structures and hierarchies as fundamentally flawed' 'an enigma machine operator whose primary filter is signal-to-noise ratio and encrypted hidden messages' 'a Zen master who communicates only through non-sequiturs, koans, and minimal, cryptic statements' 'a deep-sea volcanologist focused on extremes of pressure, heat, and slow geologic change' 'a systems engineer who focuses strictly on modularity, inter-component dependencies, and error states' 'a mythological hero'"'"'s sidekick who is overly cautious, risk-averse, and constantly points out dangers')
        ;;
    *)
        echo "Error: Invalid task ID $SLURM_ARRAY_TASK_ID"
        exit 1
        ;;
esac

echo "=============================================="
echo "Job Array Task: $SLURM_ARRAY_TASK_ID"
echo "Model: $MODEL"
echo "Agents: $N_AGENTS"
echo "Rounds: $ROUNDS"
echo "Task: $TASK"
echo "Personas: ${PERSONAS[@]}"
echo "=============================================="

# Run task-specific generation script
cd "$PROJECT_ROOT/tasks/$TASK"

case "$TASK" in
    math)
        python3 gen_math_clean.py \
            --model "$MODEL" \
            --agents "$N_AGENTS" \
            --rounds "$ROUNDS" \
            --num-problems "$NUM_VALUE" \
            --agent-personas "${PERSONAS[@]}" \
            --output-directory "$RESULTS_DIR/$TASK" \
        ;;

    gsm)
        python3 gen_gsm.py \
            --model "$MODEL" \
            --agents "$N_AGENTS" \
            --rounds "$ROUNDS" \
            --num-problems "$NUM_VALUE" \
            --agent-personas "${PERSONAS[@]}" \
            --output-directory "$RESULTS_DIR/$TASK" \
        ;;

    biography)
        python3 gen_conversation.py \
            --model "$MODEL" \
            --agents "$N_AGENTS" \
            --rounds "$ROUNDS" \
            --num-people "$NUM_VALUE" \
            --agent-personas "${PERSONAS[@]}" \
            --output-directory "$RESULTS_DIR/$TASK" \
        ;;

    mmlu)
        python3 gen_mmlu.py \
            --model "$MODEL" \
            --agents "$N_AGENTS" \
            --rounds "$ROUNDS" \
            --num-questions "$NUM_VALUE" \
            --agent-personas "${PERSONAS[@]}" \
            --output-directory "$RESULTS_DIR/$TASK" \
        ;;

    *)
        echo "Error: Unknown task '$TASK'"
        exit 1
        ;;
esac

EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "✓ Job completed successfully"
else
    echo "✗ Job failed with exit code $EXIT_CODE"
fi

exit $EXIT_CODE
